<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="微博, Swift" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Swift的基础知识基本学完，这次写的不是别的，是培训常模仿的微博项目，现在我也是边模仿边学习的心态。我会记录小码哥中模仿微博的从0到1的过程，希望以后看到自己写的烂文章会笑起来，哈哈。
另外文章篇幅可能很长很长，所以想看的同学可以好好收藏一下。如果觉得可以帮助到你的话，请Star我，也可以Fort一下工程关注项目的进展情况。当然过程中有什么问题的话，随时欢迎Issues,或者你有更好的方案也欢">
<meta property="og:type" content="article">
<meta property="og:title" content="Swift-微博">
<meta property="og:url" content="http://yoursite.com/2018/05/09/Swift-微博/index.html">
<meta property="og:site_name" content="DaiSuke">
<meta property="og:description" content="Swift的基础知识基本学完，这次写的不是别的，是培训常模仿的微博项目，现在我也是边模仿边学习的心态。我会记录小码哥中模仿微博的从0到1的过程，希望以后看到自己写的烂文章会笑起来，哈哈。
另外文章篇幅可能很长很长，所以想看的同学可以好好收藏一下。如果觉得可以帮助到你的话，请Star我，也可以Fort一下工程关注项目的进展情况。当然过程中有什么问题的话，随时欢迎Issues,或者你有更好的方案也欢">
<meta property="og:image" content="http://7xv233.com1.z0.glb.clouddn.com/weibo%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE2.gif">
<meta property="og:image" content="http://obyghtd4m.bkt.clouddn.com/weibo0766F05D-FFED-46B2-8C3F-EAE3102D3281.png">
<meta property="og:image" content="http://obyghtd4m.bkt.clouddn.com/5D4BE60E-A00C-4BFE-AC5A-836CE464DE20.png">
<meta property="og:image" content="http://obyghtd4m.bkt.clouddn.com/weibo4AC4757E-82B3-4134-B3C7-3D71F7B4B6E7.png">
<meta property="og:image" content="http://obyghtd4m.bkt.clouddn.com/weibo4AC4757E-82B3-4134-B3C7-3D71F7B4B6E7.png">
<meta property="og:image" content="http://obyghtd4m.bkt.clouddn.com/weibo7FCEAB0C-D5D4-4B15-87DB-E5859F4F4C70.png">
<meta property="og:image" content="http://obyghtd4m.bkt.clouddn.com/weibo26198C0D-96FF-4761-A63F-A6EF26D00B73.png">
<meta property="og:image" content="http://7xv233.com1.z0.glb.clouddn.com/weiboweibo%E6%96%B0%E7%89%B9%E6%80%A7.gif">
<meta property="og:image" content="http://7xv233.com1.z0.glb.clouddn.com/weibo%25E7%2595%258C%25E9%259D%25A2%25E5%2588%2587%25E6%258D%25A2%25E6%25B5%2581%25E7%25A8%258B%25E5%259B%25BE.png">
<meta property="og:image" content="http://7xv233.com1.z0.glb.clouddn.com/weibo%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE1.gif">
<meta property="og:image" content="http://7xv233.com1.z0.glb.clouddn.com/weibo%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE2.gif">
<meta property="og:updated_time" content="2018-05-10T04:04:49.791Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Swift-微博">
<meta name="twitter:description" content="Swift的基础知识基本学完，这次写的不是别的，是培训常模仿的微博项目，现在我也是边模仿边学习的心态。我会记录小码哥中模仿微博的从0到1的过程，希望以后看到自己写的烂文章会笑起来，哈哈。
另外文章篇幅可能很长很长，所以想看的同学可以好好收藏一下。如果觉得可以帮助到你的话，请Star我，也可以Fort一下工程关注项目的进展情况。当然过程中有什么问题的话，随时欢迎Issues,或者你有更好的方案也欢">
<meta name="twitter:image" content="http://7xv233.com1.z0.glb.clouddn.com/weibo%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE2.gif">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Swift-微博 | DaiSuke </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?c9ee80663574cfe4141f5d6a33812bb8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">DaiSuke</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Who am I</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Swift-微博
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2018-05-09T14:24:34+08:00" content="2018-05-09">
              2018-05-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/05/09/Swift-微博/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/05/09/Swift-微博/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/05/09/Swift-微博/" class="leancloud_visitors" data-flag-title="Swift-微博">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p><code>Swift</code>的基础知识基本学完，这次写的不是别的，是培训常模仿的微博项目，现在我也是边模仿边学习的心态。我会记录小码哥中模仿<code>微博</code>的从<code>0</code>到<code>1</code>的过程，希望以后看到自己写的烂文章会笑起来，哈哈。</p>
<p>另外文章篇幅可能很长很长，所以想看的同学可以好好收藏一下。如果觉得可以帮助到你的话，请<code>Star</code>我，也可以<code>Fort</code>一下工程关注项目的进展情况。当然过程中有什么问题的话，随时欢迎<code>Issues</code>,或者你有更好的方案也欢迎<code>Pull</code>。</p>
<p>欢迎转载，但是请注明出处，劳动成果来之不易。</p>
</blockquote>
<p><img src="http://7xv233.com1.z0.glb.clouddn.com/weibo%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE2.gif" alt="image"></p>
<a id="more"></a>
<h3 id="工程地址"><a href="#工程地址" class="headerlink" title="工程地址"></a>工程地址</h3><p><a href="https://github.com/DaisukeZJY/DWeiBo/tree/master" target="_blank" rel="external">MyWeiBoProjectForSwift</a><br>另外资源可以在工程里面找</p>
<h3 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h3><p>相信大家都会了，这里就不在述说了</p>
<h3 id="删除StoryBoard"><a href="#删除StoryBoard" class="headerlink" title="删除StoryBoard"></a>删除StoryBoard</h3><p>使用纯代码完成这个项目，所以先把故事版删除，还有把<code>info.plist</code>文件的<code>main</code>删除。如下图<br><img src="http://obyghtd4m.bkt.clouddn.com/weibo0766F05D-FFED-46B2-8C3F-EAE3102D3281.png" alt=""></p>
<h3 id="框架搭建"><a href="#框架搭建" class="headerlink" title="框架搭建"></a>框架搭建</h3><ul>
<li>首先建立工程目录</li>
</ul>
<p>按照微博的模块，可以分为<code>首页(Home)</code>、<code>消息(Message)</code>、<code>广场(Discover)</code>、<code>我(Profile)</code>四大模块，然后工程在同级别添加<code>Main</code>、<code>Common</code>、<code>Tool</code>三个模块<br>如下图：<br><img src="http://obyghtd4m.bkt.clouddn.com/5D4BE60E-A00C-4BFE-AC5A-836CE464DE20.png" alt=""></p>
<ul>
<li>搭建框架</li>
</ul>
<p>在<code>Main</code>模块中新建一个继承<code>UITabBarController</code>的自定<code>义MainViewController</code>类<br>那么好了，我们只要在<code>AppDelegate.swift</code>文件中创建Window，并把<code>rootController</code>赋值<code>MainViewController</code>就行了。</p>
<ul>
<li>在AppDelegate.swift创建视图</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line"><span class="comment">// Override point for customization after application launch.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建window</span></span><br><span class="line">window = <span class="type">UIWindow</span>(frame:<span class="type">UIScreen</span>.main.bounds)</span><br><span class="line">window?.backgroundColor = <span class="type">UIColor</span>.white</span><br><span class="line"><span class="comment">// 创建根控制器</span></span><br><span class="line">window?.rootViewController = <span class="type">MainViewController</span>()</span><br><span class="line">window?.makeKeyAndVisible()</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在首页(Home)、消息(Message)、广场(Discover)、我(Profile)模块建立主要控制器</li>
</ul>
<p>分别对应<code>HomeTableViewController</code>、<code>MessageTableViewController</code>、<code>DiscoverTableViewController</code>、<code>ProfileTableViewController</code></p>
<ul>
<li>MainViewController创建子控制器</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置当前控制器对应tabbar的颜色</span></span><br><span class="line"><span class="comment">// 注意：在iOS7以前如果设置来了titColor只有文字会变，图片不会变</span></span><br><span class="line">tabBar.tintColor = <span class="type">UIColor</span>.orange</span><br><span class="line"></span><br><span class="line"><span class="comment">//  创建首页子控制器</span></span><br><span class="line"><span class="keyword">let</span> homeVC = <span class="type">HomeTableViewController</span>()</span><br><span class="line">homeVC.title = <span class="string">"首页"</span></span><br><span class="line">homeVC.tabBarItem.image = <span class="type">UIImage</span>(named: <span class="string">"tabbar_home"</span>)</span><br><span class="line">homeVC.tabBarItem.selectedImage = <span class="type">UIImage</span>(named:imageName+<span class="string">"_highlighted"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建导航控制器包装一下</span></span><br><span class="line"><span class="keyword">let</span> homeNavC = <span class="type">UINavigationController</span>()</span><br><span class="line">homeNavC.addChildViewController(homeVC)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将导航控制器添加到当前控制器</span></span><br><span class="line">addChildViewController(homeNavC)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//  创建消息子控制器</span></span><br><span class="line"><span class="keyword">let</span> messageVC = <span class="type">MessageTableViewController</span>()</span><br><span class="line">messageVC.title = <span class="string">"消息"</span></span><br><span class="line">messageVC.tabBarItem.image = <span class="type">UIImage</span>(named: <span class="string">"tabbar_message_center"</span>)</span><br><span class="line">messageVC.tabBarItem.selectedImage = <span class="type">UIImage</span>(named:imageName+<span class="string">"_highlighted"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建导航控制器包装一下</span></span><br><span class="line"><span class="keyword">let</span> messageNavC = <span class="type">UINavigationController</span>()</span><br><span class="line">messageNavC.addChildViewController(messageVC)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将导航控制器添加到当前控制器</span></span><br><span class="line">addChildViewController(messageNavC)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//  创建广场子控制器</span></span><br><span class="line"><span class="keyword">let</span> discoverVC = <span class="type">DiscoverTableViewController</span>()</span><br><span class="line">discoverVC.title = <span class="string">"广场"</span></span><br><span class="line">discoverVC.tabBarItem.image = <span class="type">UIImage</span>(named: <span class="string">"tabbar_discover"</span>)</span><br><span class="line">discoverVC.tabBarItem.selectedImage = <span class="type">UIImage</span>(named:imageName+<span class="string">"_highlighted"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建导航控制器包装一下</span></span><br><span class="line"><span class="keyword">let</span> discoverNavC = <span class="type">UINavigationController</span>()</span><br><span class="line">discoverNavC.addChildViewController(discoverVC)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将导航控制器添加到当前控制器</span></span><br><span class="line">addChildViewController(discoverNavC)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//  创建我子控制器</span></span><br><span class="line"><span class="keyword">let</span> profileVC = <span class="type">ProfileTableViewController</span>()</span><br><span class="line">profileVC.title = <span class="string">"我"</span></span><br><span class="line">profileVC.tabBarItem.image = <span class="type">UIImage</span>(named: <span class="string">"tabbar_profile"</span>)</span><br><span class="line">profileVC.tabBarItem.selectedImage = <span class="type">UIImage</span>(named:imageName+<span class="string">"_highlighted"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建导航控制器包装一下</span></span><br><span class="line"><span class="keyword">let</span> profileNavC = <span class="type">UINavigationController</span>()</span><br><span class="line">profileNavC.addChildViewController(profileVC)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将导航控制器添加到当前控制器</span></span><br><span class="line">addChildViewController(profileNavC)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了，我们运行一下效果图</p>
<p><img src="http://obyghtd4m.bkt.clouddn.com/weibo4AC4757E-82B3-4134-B3C7-3D71F7B4B6E7.png" alt=""></p>
<ul>
<li>MainViewController重构</li>
</ul>
<p>你们有没有发现上面的代码除了类名、标题和图片的名称不一样，其他的都一样，其实很多重复的代码，我们可以使用一个方法把它搞定，而不同的可以通过参数来传递。这个就是简单的<code>重构</code>。废话不多说，上代码</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 初始化子控制器</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter childController: 需要初始化的子控制器</span></span><br><span class="line"><span class="comment">/// - parameter title:           标题</span></span><br><span class="line"><span class="comment">/// - parameter imageName:       图片</span></span><br><span class="line">fileprivate <span class="function"><span class="keyword">func</span> <span class="title">addChildViewController</span><span class="params">(<span class="number">_</span> childController: UIViewController, title:String, imageName:String)</span></span> &#123;</span><br><span class="line"><span class="comment">// 这里提示一下，fileprivate是swift3.0才有的，以前的是使用private</span></span><br><span class="line"></span><br><span class="line">childController = title</span><br><span class="line">childController.tabBarItem.image = <span class="type">UIImage</span>(named:imageName)</span><br><span class="line">childController.tabBarItem.selectedImage = <span class="type">UIImage</span>(named:imageName+<span class="string">"_highlighted"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 包装一个导航器</span></span><br><span class="line"><span class="keyword">let</span> navController = <span class="type">UINavigationController</span>()</span><br><span class="line">navController.addChildViewController(childController)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将导航器添加到当前控制器</span></span><br><span class="line">addChildViewController(navController)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法构建成功，那么在<code>viewDidLoad</code>中使用就非常简单了<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置当前控制器对应tabbar的颜色</span></span><br><span class="line"><span class="comment">// 注意：在iOS7以前如果设置来了titColor只有文字会变，图片不会变</span></span><br><span class="line">tabBar.tintColor = <span class="type">UIColor</span>.orange</span><br><span class="line"></span><br><span class="line">addChildViewController(<span class="type">HomeTableViewController</span>(), title: <span class="string">"首页"</span>, imageName: <span class="string">"tabbar_home"</span>)</span><br><span class="line">addChildViewController(<span class="type">MessageTableViewController</span>(), title: <span class="string">"消息"</span>, imageName: <span class="string">"tabbar_message_center"</span>)</span><br><span class="line">addChildViewController(<span class="type">DiscoverTableViewController</span>(), title: <span class="string">"广场"</span>, imageName: <span class="string">"tabbar_discover"</span>)</span><br><span class="line">addChildViewController(<span class="type">ProfileTableViewController</span>(), title: <span class="string">"我"</span>, imageName: <span class="string">"tabbar_profile"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行一下，是不是效果一样，然后代码立即少了许多是不是？<br><img src="http://obyghtd4m.bkt.clouddn.com/weibo4AC4757E-82B3-4134-B3C7-3D71F7B4B6E7.png" alt=""></p>
<h3 id="添加中间按钮"><a href="#添加中间按钮" class="headerlink" title="添加中间按钮"></a>添加中间按钮</h3><p>这个按钮比较特殊，所以要特殊处理一下。</p>
<p>首先，我创建一个新的控制器，作为中间按钮的占位控制器<br><img src="http://obyghtd4m.bkt.clouddn.com/weibo7FCEAB0C-D5D4-4B15-87DB-E5859F4F4C70.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">addChildViewController(<span class="string">"HomeTableViewController"</span>, title: <span class="string">"首页"</span>, imageName: <span class="string">"tabbar_home"</span>)</span><br><span class="line">addChildViewController(<span class="string">"MessageTableViewController"</span>, title: <span class="string">"消息"</span>, imageName: <span class="string">"tabbar_message_center"</span>)</span><br><span class="line"><span class="comment">// 再添加一个占位控制器</span></span><br><span class="line">addChildViewController(<span class="string">"NullViewController"</span>, title: <span class="string">""</span>, imageName: <span class="string">""</span>)</span><br><span class="line">addChildViewController(<span class="string">"DiscoverTableViewController"</span>, title: <span class="string">"广场"</span>, imageName: <span class="string">"tabbar_discover"</span>)</span><br><span class="line">addChildViewController(<span class="string">"ProfileTableViewController"</span>, title: <span class="string">"我"</span>, imageName: <span class="string">"tabbar_profile"</span>)</span><br></pre></td></tr></table></figure>
<p>然后再创建一个按钮表示中间的加号，使用懒加载的方式创建加号按钮<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fileprivate <span class="built_in">lazy</span> <span class="keyword">var</span> composeBtn:<span class="type">UIButton</span> = &#123;</span><br><span class="line"><span class="keyword">let</span> button = <span class="type">UIButton</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置前置图片</span></span><br><span class="line">button.setImage(<span class="type">UIImage</span>(named:<span class="string">"tabbar_compose_icon_add"</span>), <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">button.setImage(<span class="type">UIImage</span>(named:<span class="string">"tabbar_compose_icon_add_highlighted"</span>), <span class="keyword">for</span>: <span class="type">UIControlState</span>.highlighted)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置背景图片</span></span><br><span class="line">button.setBackgroundImage(<span class="type">UIImage</span>(named:<span class="string">"tabbar_compose_button"</span>), <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">button.setBackgroundImage(<span class="type">UIImage</span>(named:<span class="string">"tabbar_compose_button_highlighted"</span>), <span class="keyword">for</span>: <span class="type">UIControlState</span>.highlighted)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加监听事件</span></span><br><span class="line">button.addTarget(<span class="keyword">self</span>, action: #selector(<span class="type">MainViewController</span>.composeBtnClick), <span class="keyword">for</span>: <span class="type">UIControlEvents</span>.touchUpInside)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> button</span><br><span class="line"></span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure></p>
<p>注意按钮的函数绑定是<code>#selector</code>不是<code>@selector</code>,所以这里绑定一个函数，这里有个注意的地方：监听加号按钮点击，监听按钮点击方法不能私有， 按钮点击事件的调用是由  运行循环 监听并且以消息机制传递的，因此，按钮监听函数不能设置为fileprivate<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 监听加好按钮点击，注意：监听按钮点击方法不能私有</span></span><br><span class="line"><span class="comment">/// 按钮点击事件的调用是由  运行循环 监听并且以消息机制传递的，因此，按钮监听函数不能设置为`fileprivate`</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">composeBtnClick</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="built_in">print</span>(#function)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"点击按钮"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>再把加号按钮添加到tababr上，这里我抽成一个函数，顺便调整加号按钮的frame<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fileprivate <span class="function"><span class="keyword">func</span> <span class="title">addComposeButton</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加按钮</span></span><br><span class="line">tabBar.addSubview(composeBtn)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调整加好按钮的位置</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\((viewControllers?.<span class="built_in">count</span>)</span>! + 1)"</span>)</span><br><span class="line"><span class="keyword">let</span> width = <span class="type">UIScreen</span>.main.bounds.size.width / <span class="type">CGFloat</span>(viewControllers!.<span class="built_in">count</span>)</span><br><span class="line"><span class="keyword">let</span> rect = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: width, height: <span class="number">49</span>)</span><br><span class="line"></span><br><span class="line">composeBtn.frame = rect.offsetBy(dx: <span class="number">2</span> * width, dy: <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>一般都是在<code>viewDidLoad</code>这里添加并在设置<code>frame</code>，我也这么一直认为，但是我在<code>viewDidLoad</code>打印一下<code>print(tabBar.subviews)</code>，发现是空的，而在<code>viewWillAppear</code>打印却有值并且有<code>frame</code>。<code>从iOS7开始就不推荐大家在viewDidLoad中设置frame</code>，所以在<code>viewWillAppear</code>添加加号按钮<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line"><span class="keyword">super</span>.viewWillAppear(animated)</span><br><span class="line"></span><br><span class="line"><span class="comment">//        print("-----")</span></span><br><span class="line"><span class="comment">//        print(tabBar.subviews)</span></span><br><span class="line"><span class="comment">// 有值，有frame</span></span><br><span class="line">addComposeButton()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>好了，运行一下看看效果。</p>
<p><img src="http://obyghtd4m.bkt.clouddn.com/weibo26198C0D-96FF-4761-A63F-A6EF26D00B73.png" alt=""></p>
<hr>
<h2 id="更新时间：2018-04-27-14-24-34"><a href="#更新时间：2018-04-27-14-24-34" class="headerlink" title="更新时间：2018-04-27 14:24:34"></a>更新时间：2018-04-27 14:24:34</h2><h3 id="重构MainViewController"><a href="#重构MainViewController" class="headerlink" title="重构MainViewController"></a>重构MainViewController</h3><p>把子控制器的类型、标题、图片用一个json文件管理，创建一个为MainVCSetting.json文件。内容如下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"vcName"</span>: <span class="string">"HomeTableViewController"</span>,</span><br><span class="line"><span class="string">"title"</span>: <span class="string">"首页"</span>,</span><br><span class="line"><span class="string">"imageName"</span>: <span class="string">"tabbar_home"</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"vcName"</span>: <span class="string">"MessageTableViewController"</span>,</span><br><span class="line"><span class="string">"title"</span>: <span class="string">"消息"</span>,</span><br><span class="line"><span class="string">"imageName"</span>: <span class="string">"tabbar_message_center"</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"vcName"</span>: <span class="string">"NullViewController"</span>,</span><br><span class="line"><span class="string">"title"</span>: <span class="string">""</span>,</span><br><span class="line"><span class="string">"imageName"</span>: <span class="string">""</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"vcName"</span>: <span class="string">"DiscoverTableViewController"</span>,</span><br><span class="line"><span class="string">"title"</span>: <span class="string">"广场"</span>,</span><br><span class="line"><span class="string">"imageName"</span>: <span class="string">"tabbar_discover"</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"vcName"</span>: <span class="string">"ProfileTableViewController"</span>,</span><br><span class="line"><span class="string">"title"</span>: <span class="string">"我"</span>,</span><br><span class="line"><span class="string">"imageName"</span>: <span class="string">"tabbar_profile"</span></span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>那么我们就可以通过加载MainVCSetting.json文件来获取数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">fileprivate <span class="function"><span class="keyword">func</span> <span class="title">addChildViewControllers</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 获取json文件的路径</span></span><br><span class="line"><span class="keyword">let</span> path = <span class="type">Bundle</span>.main.path(forResource: <span class="string">"MainVCSetting.json"</span>, ofType: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> pathName = path &#123;</span><br><span class="line"><span class="keyword">let</span> jsonData = <span class="keyword">try</span>!<span class="type">Data</span>(contentsOf:<span class="type">URL</span>(fileURLWithPath: pathName))</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="comment">// 有可能异常代码放在这里</span></span><br><span class="line"><span class="comment">// 序列化json数据 --&gt; Array</span></span><br><span class="line"><span class="comment">// try: 发生异常会跳到catch中继续执行</span></span><br><span class="line"><span class="comment">// try!: 发生过异常程序直接崩溃</span></span><br><span class="line"><span class="keyword">let</span> dicArr = <span class="keyword">try</span> <span class="type">JSONSerialization</span>.jsonObject(with: jsonData, options: <span class="type">JSONSerialization</span>.<span class="type">ReadingOptions</span>.mutableContainers)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历数组,动态创建控制器和设置数据</span></span><br><span class="line"><span class="comment">// 在swift中，如果需要遍历一个数组，必须明确数据类型</span></span><br><span class="line"><span class="keyword">for</span> dic <span class="keyword">in</span> dicArr <span class="keyword">as</span>! [[<span class="type">String</span>: <span class="type">String</span>]] &#123;</span><br><span class="line"><span class="comment">// 报错的原因是因为addChildViewController参数必须有值，但是字典返回的是可选值</span></span><br><span class="line"><span class="comment">//                    addChildViewController(dic["vcName"], title: dic["title"], imageName: dic["imageName"])</span></span><br><span class="line">addChildViewController(dic[<span class="string">"vcName"</span>]!, title: dic[<span class="string">"title"</span>]!, imageName: dic[<span class="string">"imageName"</span>]!)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span>  &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发生异常之后会执行的代码</span></span><br><span class="line"><span class="built_in">print</span>(error)</span><br><span class="line"></span><br><span class="line"><span class="comment">//从本地创建子控制器</span></span><br><span class="line">addChildViewController(<span class="string">"HomeTableViewController"</span>, title: <span class="string">"首页"</span>, imageName: <span class="string">"tabbar_home"</span>)</span><br><span class="line">addChildViewController(<span class="string">"MessageTableViewController"</span>, title: <span class="string">"消息"</span>, imageName: <span class="string">"tabbar_message_center"</span>)</span><br><span class="line"><span class="comment">// 再添加一个占位控制器</span></span><br><span class="line">addChildViewController(<span class="string">"NullViewController"</span>, title: <span class="string">""</span>, imageName: <span class="string">""</span>)</span><br><span class="line">addChildViewController(<span class="string">"DiscoverTableViewController"</span>, title: <span class="string">"广场"</span>, imageName: <span class="string">"tabbar_discover"</span>)</span><br><span class="line">addChildViewController(<span class="string">"ProfileTableViewController"</span>, title: <span class="string">"我"</span>, imageName: <span class="string">"tabbar_profile"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>初始化每一个子控制器</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 初始化子控制器</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// - parameter childController: 需要初始化的子控制器</span></span><br><span class="line"><span class="comment">/// - parameter title:           标题</span></span><br><span class="line"><span class="comment">/// - parameter imageName:       图片</span></span><br><span class="line">fileprivate <span class="function"><span class="keyword">func</span> <span class="title">addChildViewController</span><span class="params">(<span class="number">_</span> childControllerName: String, title:String, imageName:String)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置首页对应的数据</span></span><br><span class="line"><span class="comment">//        childController.title = title</span></span><br><span class="line"><span class="comment">//        childController.tabBarItem.image = UIImage(named:imageName)</span></span><br><span class="line"><span class="comment">//        childController.tabBarItem.selectedImage = UIImage(named:imageName+"_highlighted")</span></span><br><span class="line"><span class="comment">// 动态获取命名空间</span></span><br><span class="line"><span class="keyword">let</span> bundleString = <span class="type">Bundle</span>.main.infoDictionary![<span class="string">"CFBundleExecutable"</span>] <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将字符串转为类</span></span><br><span class="line"><span class="keyword">let</span> className:<span class="type">AnyClass</span>? = <span class="type">NSClassFromString</span>(bundleString + <span class="string">"."</span> + childControllerName)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过类创建对象</span></span><br><span class="line"><span class="comment">// 将AnyClass转为指定的类型</span></span><br><span class="line"><span class="keyword">let</span> vcClass = className <span class="keyword">as</span>! <span class="type">UIViewController</span>.<span class="type">Type</span></span><br><span class="line"><span class="comment">// 通过class创建对象</span></span><br><span class="line"><span class="keyword">let</span> vc = vcClass.<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">vc.title = title</span><br><span class="line"><span class="comment">//        vc.tabBarItem.image = UIImage(named:imageName)</span></span><br><span class="line">vc.tabBarItem.image = <span class="type">UIImage</span>.<span class="keyword">init</span>(named: imageName)</span><br><span class="line">vc.tabBarItem.selectedImage = <span class="type">UIImage</span>(named:imageName+<span class="string">"_highlighted"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 包装一个导航器</span></span><br><span class="line"><span class="keyword">let</span> navController = <span class="type">UINavigationController</span>()</span><br><span class="line">navController.addChildViewController(vc)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将导航器添加到当前控制器</span></span><br><span class="line">addChildViewController(navController)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加VisitorView视图"><a href="#添加VisitorView视图" class="headerlink" title="添加VisitorView视图"></a>添加VisitorView视图</h3><p>添加一个自定义VisitorView游客视图，作为每个控制器的基本视图。当没有登录的情况下展示的是VisitorView视图。</p>
<p>为了方便布局，使用UIView+AutoLayout分类布局文件，具体可在工程中找到。</p>
<p>下面是VisitorView视图的关键的代码片段：</p>
<h4 id="定义协议"><a href="#定义协议" class="headerlink" title="定义协议"></a>定义协议</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Swift中如何定义协议：必须遵守NSObjectProtocol</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">VisitorViewDelegate</span>: <span class="title">NSObjectProtocol</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="comment">// 登录回调</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loginBtnWillClick</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册回调</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerBtnWillClick</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用弱引用"><a href="#使用弱引用" class="headerlink" title="使用弱引用"></a>使用弱引用</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个属性保存代理对象</span></span><br><span class="line"><span class="comment">// 一定要加上weak，避免循环引用</span></span><br><span class="line"><span class="keyword">weak</span> <span class="keyword">var</span> delegate: <span class="type">VisitorViewDelegate</span>?</span><br></pre></td></tr></table></figure>
<h4 id="重写初始化方法注意点"><a href="#重写初始化方法注意点" class="headerlink" title="重写初始化方法注意点"></a>重写初始化方法注意点</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</span><br><span class="line"><span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swift推荐我们自定义一个空间，要么用纯代码，要么使用xib/stroyboard</span></span><br><span class="line"><span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line"><span class="comment">// 如果用过xib/stroyboard创建该类，那么就会崩溃</span></span><br><span class="line"><span class="built_in">fatalError</span>(<span class="string">"init(coder:) has not been implemented"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加BaseViewController控制器"><a href="#添加BaseViewController控制器" class="headerlink" title="添加BaseViewController控制器"></a>添加BaseViewController控制器</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个变量保存用户当前是否是登录</span></span><br><span class="line"><span class="keyword">var</span> userLogin = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义属性保存未登录界面</span></span><br><span class="line"><span class="keyword">var</span> visitorView: <span class="type">VisitorView</span>?</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">loadView</span><span class="params">()</span></span> &#123;</span><br><span class="line">userLogin ? <span class="keyword">super</span>.loadView() : setupVisitorView()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fileprivate <span class="function"><span class="keyword">func</span> <span class="title">setupVisitorView</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// 初始化未登录界面</span></span><br><span class="line"><span class="keyword">let</span> visitorView = <span class="type">VisitorView</span>()</span><br><span class="line"><span class="comment">// 设置当前控制器为代理，那么BaseViewController就要遵循VisitorViewDelegate协议</span></span><br><span class="line">visitorView.delegate = <span class="keyword">self</span></span><br><span class="line">view = visitorView</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置导航条未登录按钮</span></span><br><span class="line">navigationItem.leftBarButtonItem = <span class="type">UIBarButtonItem</span>(title: <span class="string">"注册"</span>, style: <span class="type">UIBarButtonItemStyle</span>.plain, target: <span class="keyword">self</span>, action: #selector(<span class="type">BaseViewController</span>.registerBtnWillClick))</span><br><span class="line">navigationItem.rightBarButtonItem = <span class="type">UIBarButtonItem</span>(title: <span class="string">"登录"</span>, style: <span class="type">UIBarButtonItemStyle</span>.plain, target: <span class="keyword">self</span>, action: #selector(<span class="type">BaseViewController</span>.loginBtnWillClick))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于BaseViewController控制器遵循VisitorViewDelegate协议，那么VisitorViewDelegate的相应方法就要实现：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loginBtnWillClick</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="built_in">print</span>(#function)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerBtnWillClick</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="built_in">print</span>(#function)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="主控制器继承基类"><a href="#主控制器继承基类" class="headerlink" title="主控制器继承基类"></a>主控制器继承基类</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeTableViewController</span>: <span class="title">BaseViewController</span></span><br><span class="line"><span class="title">class</span> <span class="title">DiscoverTableViewController</span>: <span class="title">BaseViewController</span></span><br><span class="line"><span class="title">class</span> <span class="title">MessageTableViewController</span>: <span class="title">BaseViewController</span></span><br><span class="line"><span class="title">class</span> <span class="title">ProfileTableViewController</span>: <span class="title">BaseViewController</span></span></span><br></pre></td></tr></table></figure>
<h3 id="导航条按钮"><a href="#导航条按钮" class="headerlink" title="导航条按钮"></a>导航条按钮</h3><p>导航栏中使用UIBarButtonItem来显示每一个item，那么现在为了方便创建，使用扩展extension声明一个类型方法。</p>
<p>创建一个Swift文件，名为：UIBarButtonItem+Category</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIBarButtonItem</span> </span>&#123;</span><br><span class="line"><span class="comment">// 声明一个类型方法，类方法使用class关键字</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">createBarButtonItem</span>(<span class="title">_</span> <span class="title">imageName</span>:<span class="title">String</span>, <span class="title">target</span>:<span class="title">AnyObject</span>?, <span class="title">action</span>:<span class="title">Selector</span>) -&gt; <span class="title">UIBarButtonItem</span> </span>&#123;</span><br><span class="line"><span class="keyword">let</span> btn = <span class="type">UIButton</span>()</span><br><span class="line">btn.setImage(<span class="type">UIImage</span>(named: imageName), <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">btn.setImage(<span class="type">UIImage</span>(named: imageName), <span class="keyword">for</span>: <span class="type">UIControlState</span>.highlighted)</span><br><span class="line">btn.addTarget(target, action: action, <span class="keyword">for</span>: <span class="type">UIControlEvents</span>.touchUpInside)</span><br><span class="line">btn.sizeToFit()</span><br><span class="line"><span class="keyword">return</span> <span class="type">UIBarButtonItem</span>(customView: btn)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么在HomeTableViewController中创建导航栏的UIBarButtonItem就可以这样：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setupNav</span><span class="params">()</span></span> &#123;</span><br><span class="line">navigationItem.leftBarButtonItem = <span class="type">UIBarButtonItem</span>.createBarButtonItem(<span class="string">"navigationbar_friendattention"</span>, target: <span class="keyword">self</span>, action: #selector(leftItemClick))</span><br><span class="line">navigationItem.rightBarButtonItem = <span class="type">UIBarButtonItem</span>.createBarButtonItem(<span class="string">"navigationbar_pop"</span>, target: <span class="keyword">self</span>, action: #selector(rightItemClick))</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> titleBtn = <span class="type">UIButton</span>()</span><br><span class="line">titleBtn.setTitleColor(<span class="type">UIColor</span>.darkGray, <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">titleBtn.setImage(<span class="type">UIImage</span>(named: <span class="string">"navigationbar_arrow_down"</span>), <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">titleBtn.setImage(<span class="type">UIImage</span>(named: <span class="string">"navigationbar_arrow_up"</span>), <span class="keyword">for</span>: <span class="type">UIControlState</span>.selected)</span><br><span class="line">titleBtn.setTitle(<span class="string">" WeiBo"</span>, <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">titleBtn.addTarget(<span class="keyword">self</span>, action: #selector(titleItemClick(<span class="number">_</span>:)), <span class="keyword">for</span>: <span class="type">UIControlEvents</span>.touchUpInside)</span><br><span class="line">titleBtn.sizeToFit()</span><br><span class="line">navigationItem.titleView = titleBtn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="更新时间：2018-04-27-16-53-34"><a href="#更新时间：2018-04-27-16-53-34" class="headerlink" title="更新时间：2018-04-27 16:53:34"></a>更新时间：2018-04-27 16:53:34</h2><h3 id="CocoPods"><a href="#CocoPods" class="headerlink" title="CocoPods"></a>CocoPods</h3><h4 id="第三方框架"><a href="#第三方框架" class="headerlink" title="第三方框架"></a>第三方框架</h4><h5 id="项目中使用到以下第三方框架"><a href="#项目中使用到以下第三方框架" class="headerlink" title="项目中使用到以下第三方框架"></a>项目中使用到以下第三方框架</h5><ul>
<li><code>AFNetworking</code></li>
<li><code>SDWebImage</code></li>
<li><code>SVProgressHUD</code></li>
</ul>
<h4 id="Pod-安装"><a href="#Pod-安装" class="headerlink" title="Pod 安装"></a>Pod 安装</h4><ul>
<li>git 备份</li>
<li>打开终端</li>
<li><code>$ cd</code> 进入项目目录</li>
<li>输入以下终端命令建立或编辑 <code>Podfile</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim Podfile</span><br></pre></td></tr></table></figure>
<ul>
<li>输入以下内容</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use_frameworks!</span><br><span class="line">pod &apos;AFNetworking&apos;</span><br><span class="line">pod &apos;SDWebImage&apos;</span><br><span class="line">pod &apos;SVProgressHUD&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>:wq</code> 保存退出</li>
</ul>
<blockquote>
<p>在 Swift 项目中，cocoapod 仅支持以 Framework 方式添加框架，因此需要在 Podfile 中添加 <code>use_frameworks!</code></p>
</blockquote>
<h4 id="在终端提交添加的框架"><a href="#在终端提交添加的框架" class="headerlink" title="在终端提交添加的框架"></a>在终端提交添加的框架</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将修改添加至暂存区</span></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交修改并且添加备注信息</span></span><br><span class="line">$ git commit -m <span class="string">"添加第三方框架"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将修改推送到远程服务器</span></span><br><span class="line">$ git push</span><br></pre></td></tr></table></figure>
<h4 id="安装第三方框架"><a href="#安装第三方框架" class="headerlink" title="安装第三方框架"></a>安装第三方框架</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装第三方框架</span></span><br><span class="line">pod install</span><br></pre></td></tr></table></figure>
<h4 id="打开xcworkspace工程"><a href="#打开xcworkspace工程" class="headerlink" title="打开xcworkspace工程"></a>打开xcworkspace工程</h4><p>退出当前工程，进入目录，打开xcworkspace工程即可</p>
<h4 id="添加桥接文件DWeibo-Bridge"><a href="#添加桥接文件DWeibo-Bridge" class="headerlink" title="添加桥接文件DWeibo-Bridge"></a>添加桥接文件DWeibo-Bridge</h4><ul>
<li>使用 Xcode 打开工作组文件</li>
<li>在 <code>Supporting Files</code> 下添加桥接文件 <code>Weibo-Bridge.h</code></li>
<li>输入以下内容</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;SDWebImage/UIImageView+WebCache.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;SVProgressHUD/SVProgressHUD.h&gt;</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>点击 <code>项目</code> - <code>TARGETS</code> - <code>Build Settings</code></li>
<li>搜索 <code>bridg</code></li>
<li>在 <code>Objective-C Bridging Header</code> 中输入 <code>DWeibo/DWeibo-Bridge.h</code>路径</li>
</ul>
<p>然后在swift文件中导入SVProgressHUD，这样就可以使用OC的SVProgressHUD框架了。</p>
<hr>
<h2 id="更新时间：2018-04-28-15-28-34"><a href="#更新时间：2018-04-28-15-28-34" class="headerlink" title="更新时间：2018-04-28 15:28:34"></a>更新时间：2018-04-28 15:28:34</h2><h3 id="微博API"><a href="#微博API" class="headerlink" title="微博API"></a>微博API</h3><p>接入<a href="http://open.weibo.com/wiki/微博API" target="_blank" rel="external">微博API</a>，里面的有许多接口，相对应实现即可。有一些分高级接口，可灵活选择。</p>
<h3 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h3><p>使用<a href="http://open.weibo.com/wiki/Oauth2/authorize" target="_blank" rel="external">OAuth 2.0授权接口</a></p>
<p>创建应用：我的应用，获取<code>App Key</code>,<code>App Secret</code>,<code>授权回调页：http://daisuke.cn</code>这三个值，作为授权的参数。</p>
<h4 id="创建OAuthViewController"><a href="#创建OAuthViewController" class="headerlink" title="创建OAuthViewController"></a>创建OAuthViewController</h4><ol>
<li>声明需要的参数：</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">WB_App_Key</span> = <span class="string">"2624860832"</span></span><br><span class="line"><span class="keyword">let</span> <span class="type">WB_App_Secret</span> = <span class="string">"75430fcbef20686409d7b775b1f10f5e"</span></span><br><span class="line"><span class="keyword">let</span> <span class="type">WB_redirect_uri</span> = <span class="string">"http://www.daisuke.cn"</span></span><br></pre></td></tr></table></figure>
<ol>
<li>拼接获取未授权的RequestToken的路径并加载：</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> urlStr = <span class="string">"https://api.weibo.com/oauth2/authorize?client_id=<span class="subst">\(WB_App_Key)</span>&amp;redirect_uri=<span class="subst">\(WB_redirect_uri)</span>"</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="type">NSURL</span>(string: urlStr)</span><br><span class="line"><span class="keyword">let</span> request = <span class="type">NSURLRequest</span>(<span class="type">URL</span>: url!)</span><br><span class="line">webView.loadRequest(request)</span><br></pre></td></tr></table></figure>
<p>3.遵循UIWebViewDelegate实现方法，利用已经授权的RequestToken换取AccessToken</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">OAuthViewController</span>: <span class="title">UIWebViewDelegate</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">// 返回true正常加载，返回false不加载</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webView</span><span class="params">(<span class="number">_</span> webView: UIWebView, shouldStartLoadWith request: URLRequest, navigationType: UIWebViewNavigationType)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="comment">// 判断是否授权回调页面，如果不是继续加载</span></span><br><span class="line">        <span class="keyword">let</span> urlStr = request.url!.absoluteString</span><br><span class="line">        <span class="keyword">if</span> !urlStr.hasPrefix(kRedirectUrl) &#123;</span><br><span class="line">            <span class="comment">// 继续加载</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否授权</span></span><br><span class="line">        <span class="keyword">let</span> codeStr = <span class="string">"code="</span></span><br><span class="line">        <span class="keyword">if</span> request.url!.query!.hasPrefix(codeStr) &#123;</span><br><span class="line">            <span class="comment">// 授权成功</span></span><br><span class="line">            <span class="comment">// 取出已经授权的RequestToken</span></span><br><span class="line">            <span class="keyword">let</span> code = request.url!.query!.substring(from: codeStr.endIndex)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 利用已经授权的RequestToken换取AccessToken</span></span><br><span class="line">            loadAccessToken(code: code)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                close()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webViewDidStartLoad</span><span class="params">(<span class="number">_</span> webView: UIWebView)</span></span> &#123;</span><br><span class="line">        <span class="type">SVProgressHUD</span>.show(withStatus: <span class="string">"正在加载..."</span>)</span><br><span class="line">        <span class="type">SVProgressHUD</span>.setDefaultMaskType(<span class="type">SVProgressHUDMaskType</span>.black)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">webViewDidFinishLoad</span><span class="params">(<span class="number">_</span> webView: UIWebView)</span></span> &#123;</span><br><span class="line">        <span class="type">SVProgressHUD</span>.dismiss()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - 自定方法</span></span><br><span class="line">    <span class="comment">/// 换取AccessToken</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">loadAccessToken</span><span class="params">(code:String)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 定义路径</span></span><br><span class="line">        <span class="keyword">let</span> path = <span class="string">"oauth2/access_token"</span></span><br><span class="line">        <span class="comment">// 封装参数</span></span><br><span class="line">        <span class="keyword">let</span> params = [<span class="string">"client_id"</span>:kAppKey, <span class="string">"client_secret"</span>:kAppSecret, <span class="string">"grant_type"</span>:<span class="string">"authorization_code"</span>, <span class="string">"code"</span>:code, <span class="string">"redirect_uri"</span>:kRedirectUrl]</span><br><span class="line"></span><br><span class="line">        <span class="type">NetworkTools</span>.shareNetworkTools().post(path, parameters: params, progress: &#123; (<span class="number">_</span>) <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">            &#125;, success: &#123; (<span class="number">_</span>, json) <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(json <span class="keyword">as</span> <span class="type">Any</span>)</span><br><span class="line">            <span class="comment">/*</span><br><span class="line">            字典转模型</span><br><span class="line">            plist：特点只能存储系统自带的数据类型</span><br><span class="line">            将对象转化为json之后写入文件中</span><br><span class="line">            偏好设置：本质plist</span><br><span class="line">            归档：可以存储自定义对象</span><br><span class="line">            数据库：用于存储大数据，特点效率高</span><br><span class="line">            */</span></span><br><span class="line">            <span class="keyword">let</span> user = <span class="type">UserAccount</span>(dict: json <span class="keyword">as</span>! [<span class="type">String</span> : <span class="type">AnyObject</span>])</span><br><span class="line">            <span class="built_in">print</span>(user)</span><br><span class="line">            user.loadUserInfo(finishBlock: &#123; (account, error) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> account != <span class="literal">nil</span> &#123;</span><br><span class="line">                account!.saveAccount()</span><br><span class="line">                <span class="type">SVProgressHUD</span>.dismiss()</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">SVProgressHUD</span>.show(withStatus: <span class="string">"网络不给力"</span>)</span><br><span class="line">            <span class="type">SVProgressHUD</span>.setDefaultMaskType(<span class="type">SVProgressHUDMaskType</span>.black)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 由于加载用户信息是异步的，所以不能在这里保存</span></span><br><span class="line">            <span class="comment">//            // 归档模型</span></span><br><span class="line">            <span class="comment">//            user.saveAccount()</span></span><br><span class="line"></span><br><span class="line">        &#125;) &#123; (<span class="number">_</span>, error) <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="UserAccount存储用户信息"><a href="#UserAccount存储用户信息" class="headerlink" title="UserAccount存储用户信息"></a>UserAccount存储用户信息</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swift2.0 打印对象需要重写CustomStringConvertible协议中的description</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAccount</span>: <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// 用于调用access_token，接口获取授权后的access token。</span></span><br><span class="line">    <span class="keyword">var</span> access_token: <span class="type">String</span>?</span><br><span class="line">    <span class="comment">/// access_token的生命周期，单位是秒数。</span></span><br><span class="line">    <span class="keyword">var</span> expires_in: <span class="type">NSNumber</span>?</span><br><span class="line">    <span class="comment">/// 当前授权用户的UID。</span></span><br><span class="line">    <span class="keyword">var</span> uid:<span class="type">String</span>?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">init</span>(dict: [<span class="type">String</span>: <span class="type">AnyObject</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        access_token = dict[<span class="string">"access_token"</span>] <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">        expires_in = dict[<span class="string">"expires_in"</span>] <span class="keyword">as</span>? <span class="type">NSNumber</span></span><br><span class="line">        uid = dict[<span class="string">"uid"</span>] <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span>&#123;</span><br><span class="line">        <span class="comment">// 1.定义属性数组</span></span><br><span class="line">        <span class="keyword">let</span> properties = [<span class="string">"access_token"</span>, <span class="string">"expires_in"</span>, <span class="string">"uid"</span>]</span><br><span class="line">        <span class="comment">// 2.根据属性数组, 将属性转换为字典</span></span><br><span class="line">        <span class="keyword">let</span> dict =  <span class="keyword">self</span>.dictionaryWithValuesForKeys(properties)</span><br><span class="line">        <span class="comment">// 3.将字典转换为字符串</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"<span class="subst">\(dict)</span>"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="归档用户信息"><a href="#归档用户信息" class="headerlink" title="归档用户信息"></a>归档用户信息</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - 保存和读取  Keyed</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line">保存授权模型</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">saveAccount</span><span class="params">()</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="type">NSSearchPathForDirectoriesInDomains</span>(<span class="type">NSSearchPathDirectory</span>.<span class="type">CachesDirectory</span>, <span class="type">NSSearchPathDomainMask</span>.<span class="type">UserDomainMask</span>, <span class="literal">true</span>).last!</span><br><span class="line">    <span class="keyword">let</span> filePath = (path <span class="keyword">as</span> <span class="type">NSString</span>).stringByAppendingPathComponent(<span class="string">"account.plist"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"filePath <span class="subst">\(filePath)</span>"</span>)</span><br><span class="line">    <span class="type">NSKeyedArchiver</span>.archiveRootObject(<span class="keyword">self</span>, toFile: filePath)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 加载授权模型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">loadAccount</span>() -&gt; <span class="title">UserAccount</span>? </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="type">NSSearchPathForDirectoriesInDomains</span>(<span class="type">NSSearchPathDirectory</span>.<span class="type">CachesDirectory</span>, <span class="type">NSSearchPathDomainMask</span>.<span class="type">UserDomainMask</span>, <span class="literal">true</span>).last!</span><br><span class="line">    <span class="keyword">let</span> filePath = (path <span class="keyword">as</span> <span class="type">NSString</span>).stringByAppendingPathComponent(<span class="string">"account.plist"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"filePath <span class="subst">\(filePath)</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> account =  <span class="type">NSKeyedUnarchiver</span>.unarchiveObjectWithFile(filePath) <span class="keyword">as</span>? <span class="type">UserAccount</span></span><br><span class="line">    <span class="keyword">return</span> account</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - NSCoding</span></span><br><span class="line"><span class="comment">// 将对象写入到文件中</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">encodeWithCoder</span><span class="params">(aCoder: NSCoder)</span></span></span><br><span class="line">&#123;</span><br><span class="line">    aCoder.encodeObject(access_token, forKey: <span class="string">"access_token"</span>)</span><br><span class="line">    aCoder.encodeObject(expires_in, forKey: <span class="string">"expires_in"</span>)</span><br><span class="line">    aCoder.encodeObject(uid, forKey: <span class="string">"uid"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 从文件中读取对象</span></span><br><span class="line"><span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>)</span><br><span class="line">&#123;</span><br><span class="line">    access_token = aDecoder.decodeObjectForKey(<span class="string">"access_token"</span>) <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">    expires_in = aDecoder.decodeObjectForKey(<span class="string">"expires_in"</span>) <span class="keyword">as</span>? <span class="type">NSNumber</span></span><br><span class="line">    uid = aDecoder.decodeObjectForKey(<span class="string">"uid"</span>) <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="获取用户信息"><a href="#获取用户信息" class="headerlink" title="获取用户信息"></a>获取用户信息</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadUserInfo</span><span class="params">(finishBlock: @escaping <span class="params">(<span class="number">_</span> account: UserAccount?, <span class="number">_</span> error: NSError?)</span></span></span>-&gt;()) &#123;</span><br><span class="line">    <span class="built_in">assert</span>(access_token != <span class="literal">nil</span>, <span class="string">"没有授权"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> path = <span class="string">"2/users/show.json"</span></span><br><span class="line">    <span class="keyword">let</span> params = [<span class="string">"access_token"</span>:access_token, <span class="string">"uid"</span>:uid]</span><br><span class="line"></span><br><span class="line">    <span class="type">NetworkTools</span>.shareNetworkTools().<span class="keyword">get</span>(path, parameters: params, progress: <span class="literal">nil</span>, success: &#123; (<span class="number">_</span>, json) <span class="keyword">in</span></span><br><span class="line">        <span class="built_in">print</span>(json <span class="keyword">as</span> <span class="type">Any</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> dict = json <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">AnyObject</span>] &#123;</span><br><span class="line">            <span class="keyword">self</span>.avatar_large = dict[<span class="string">"avatar_large"</span>] <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">            <span class="keyword">self</span>.screen_name = dict[<span class="string">"screen_name"</span>] <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存信息</span></span><br><span class="line">            finishBlock(<span class="keyword">self</span>, <span class="literal">nil</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        finishBlock(<span class="literal">nil</span>, <span class="literal">nil</span>)</span><br><span class="line">        &#125;) &#123; (<span class="number">_</span>, error) <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(error)</span><br><span class="line">            finishBlock(<span class="literal">nil</span>, error <span class="keyword">as</span> <span class="type">NSError</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="更新时间：2018-05-08-15-07-39"><a href="#更新时间：2018-05-08-15-07-39" class="headerlink" title="更新时间：2018-05-08 15:07:39"></a>更新时间：2018-05-08 15:07:39</h2><h3 id="新特性"><a href="#新特性" class="headerlink" title="新特性"></a>新特性</h3><h4 id="创建NewFeatureViewController"><a href="#创建NewFeatureViewController" class="headerlink" title="创建NewFeatureViewController"></a>创建NewFeatureViewController</h4><p>NewFeatureViewController继承UICollectionViewController</p>
<p>实现UICollectionViewDataSource</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - UICollectionViewDataSource</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, numberOfItemsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> pageCount</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, cellForItemAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UICollectionViewCell</span> &#123;</span><br><span class="line">    <span class="comment">// 获取cell</span></span><br><span class="line">    <span class="keyword">let</span> cell = collectionView.dequeueReusableCell(withReuseIdentifier: reuseIdentifier, <span class="keyword">for</span>: indexPath) <span class="keyword">as</span>! <span class="type">NewFeatureCell</span></span><br><span class="line">    cell.imgaeIndex = indexPath.item</span><br><span class="line">    <span class="keyword">return</span> cell</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="创建NewFeatureCell"><a href="#创建NewFeatureCell" class="headerlink" title="创建NewFeatureCell"></a>创建NewFeatureCell</h4><p>实现每一个cell的样式在NewFeatureViewController的显示</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">NewFeatureCell</span>: <span class="title">UICollectionViewCell</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> iconView: <span class="type">UIImageView</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> view = <span class="type">UIImageView</span>()</span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存图片的索引</span></span><br><span class="line">    <span class="comment">// Swift中被private修饰的东西，如果同一个文件中是可以访问的</span></span><br><span class="line">    <span class="keyword">var</span> imgaeIndex:<span class="type">Int</span>?&#123;</span><br><span class="line">        <span class="keyword">didSet</span> &#123;</span><br><span class="line">            iconView.image = <span class="type">UIImage</span>(named: <span class="string">"new_feature_<span class="subst">\(imgaeIndex! + <span class="number">1</span>)</span>"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line">        setupUI()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"init(coder:) has not been implemented"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setupUI</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// 添加到contentView控件上</span></span><br><span class="line">        contentView.addSubview(iconView)</span><br><span class="line">        iconView.xmg_Fill(contentView)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="创建NewFeatureLayout"><a href="#创建NewFeatureLayout" class="headerlink" title="创建NewFeatureLayout"></a>创建NewFeatureLayout</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 布局对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">NewFeatureLayout</span>: <span class="title">UICollectionViewFlowLayout</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重谢准备布局方法</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// 设置layout布局</span></span><br><span class="line">        itemSize = <span class="type">UIScreen</span>.main.bounds.size</span><br><span class="line">        minimumLineSpacing = <span class="number">0</span></span><br><span class="line">        minimumInteritemSpacing = <span class="number">0</span></span><br><span class="line">        scrollDirection = <span class="type">UICollectionViewScrollDirection</span>.horizontal</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置collectionView的属性</span></span><br><span class="line">        collectionView?.showsHorizontalScrollIndicator = <span class="literal">false</span></span><br><span class="line">        collectionView?.bounces = <span class="literal">false</span></span><br><span class="line">        collectionView?.isPagingEnabled = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完善-amp-添加按钮"><a href="#完善-amp-添加按钮" class="headerlink" title="完善&amp;添加按钮"></a>完善&amp;添加按钮</h3><p>添加按钮</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">lazy</span> <span class="keyword">var</span> startBtn: <span class="type">UIButton</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> btn = <span class="type">UIButton</span>()</span><br><span class="line">    btn.setBackgroundImage(<span class="type">UIImage</span>(named: <span class="string">"new_feature_button"</span>), <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">    btn.setBackgroundImage(<span class="type">UIImage</span>(named: <span class="string">"new_feature_button"</span>), <span class="keyword">for</span>: <span class="type">UIControlState</span>.highlighted)</span><br><span class="line">    btn.isHidden = <span class="literal">true</span></span><br><span class="line">    btn.addTarget(<span class="keyword">self</span>, action: #selector(clickStartBtn), <span class="keyword">for</span>: <span class="type">UIControlEvents</span>.touchUpInside)</span><br><span class="line">    <span class="keyword">return</span> btn</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<p>添加按钮显示动画</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 给按钮做个动画</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startBtnAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    startBtn.isHidden = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行动画</span></span><br><span class="line">    startBtn.transform = <span class="type">CGAffineTransform</span>.<span class="keyword">init</span>(scaleX: <span class="number">0</span>, y: <span class="number">0</span>)</span><br><span class="line">    startBtn.isUserInteractionEnabled = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="type">UIView</span>.animate(withDuration: <span class="number">2</span>, delay: <span class="number">0</span>, usingSpringWithDamping: <span class="number">0.8</span>, initialSpringVelocity: <span class="number">10</span>, options: <span class="type">UIViewAnimationOptions</span>(rawValue: <span class="number">0</span>), animations: &#123;</span><br><span class="line">        <span class="comment">// 清空形变</span></span><br><span class="line">        <span class="keyword">self</span>.startBtn.transform = <span class="type">CGAffineTransform</span>.identity</span><br><span class="line">    &#125;) &#123; (<span class="number">_</span>) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span>.startBtn.isUserInteractionEnabled = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在最后一个cell显示完毕的时候执行按钮动画</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 完全显示完cell之后调用</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">collectionView</span><span class="params">(<span class="number">_</span> collectionView: UICollectionView, didEndDisplaying cell: UICollectionViewCell, forItemAt indexPath: IndexPath)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 拿到当前显示的cell对应的索引</span></span><br><span class="line">    <span class="keyword">let</span> path = collectionView.indexPathsForVisibleItems.last</span><br><span class="line">    <span class="built_in">print</span>(path <span class="keyword">as</span> <span class="type">Any</span>)</span><br><span class="line">    <span class="keyword">if</span> path?.item == (pageCount - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 拿到当前索引对应的cell</span></span><br><span class="line">        <span class="keyword">let</span> cell = collectionView.cellForItem(at: path!) <span class="keyword">as</span>! <span class="type">NewFeatureCell</span></span><br><span class="line">        cell.startBtnAnimation()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://7xv233.com1.z0.glb.clouddn.com/weiboweibo%E6%96%B0%E7%89%B9%E6%80%A7.gif" alt="image"></p>
<hr>
<h2 id="更新时间：2018-05-08-16-00-03"><a href="#更新时间：2018-05-08-16-00-03" class="headerlink" title="更新时间：2018-05-08 16:00:03"></a>更新时间：2018-05-08 16:00:03</h2><h3 id="添加欢迎界面"><a href="#添加欢迎界面" class="headerlink" title="添加欢迎界面"></a>添加欢迎界面</h3><p>创建WelcomViewController继承于UIViewController</p>
<h4 id="添加子控件"><a href="#添加子控件" class="headerlink" title="添加子控件"></a>添加子控件</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - 懒加载</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> bgImageView: <span class="type">UIImageView</span> = <span class="type">UIImageView</span>(image: <span class="type">UIImage</span>(named: <span class="string">"ad_background"</span>))</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> iconView: <span class="type">UIImageView</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> view = <span class="type">UIImageView</span>(image: <span class="type">UIImage</span>(named: <span class="string">"avatar_default_big"</span>))</span><br><span class="line">    view.layer.cornerRadius = <span class="number">50</span></span><br><span class="line">    view.layer.masksToBounds = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> view</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> message: <span class="type">UILabel</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> label = <span class="type">UILabel</span>()</span><br><span class="line">    label.text = <span class="string">"欢迎归来"</span></span><br><span class="line">    label.alpha = <span class="number">0.0</span></span><br><span class="line">    label.sizeToFit()</span><br><span class="line">    <span class="keyword">return</span> label</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<h4 id="添加显示动画"><a href="#添加显示动画" class="headerlink" title="添加显示动画"></a>添加显示动画</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewWillAppear</span><span class="params">(<span class="number">_</span> animated: Bool)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewWillAppear(animated)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提示：修改约束不会立即生效，添加了一个标记，统一由自动布局系统更新约束</span></span><br><span class="line">    bottomConstaint?.constant = -<span class="type">UIScreen</span>.main.bounds.height - bottomConstaint!.constant</span><br><span class="line">    <span class="built_in">print</span>(-<span class="type">UIScreen</span>.main.bounds.height)</span><br><span class="line">    <span class="built_in">print</span>(bottomConstaint!.constant)</span><br><span class="line"></span><br><span class="line">    <span class="type">UIView</span>.animate(withDuration: <span class="number">1.2</span>, delay: <span class="number">0</span>, usingSpringWithDamping: <span class="number">0.8</span>, initialSpringVelocity: <span class="number">10</span>, options: <span class="type">UIViewAnimationOptions</span>(rawValue: <span class="number">0</span>), animations: &#123;</span><br><span class="line">        <span class="comment">// 强制更新约束</span></span><br><span class="line">        <span class="keyword">self</span>.view.layoutIfNeeded()</span><br><span class="line">    &#125;) &#123; (finish) <span class="keyword">in</span></span><br><span class="line">        <span class="type">UIView</span>.animate(withDuration: <span class="number">1.2</span>, delay: <span class="number">0</span>, usingSpringWithDamping: <span class="number">0.8</span>, initialSpringVelocity: <span class="number">10</span>, options: <span class="type">UIViewAnimationOptions</span>(rawValue: <span class="number">0</span>), animations: &#123;</span><br><span class="line">            <span class="keyword">self</span>.message.alpha = <span class="number">1.0</span></span><br><span class="line">        &#125;) &#123; (finish) <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"OK"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>usingSpringWithDamping 的范围为 0.0f 到 1.0f，数值越小 弹簧 的振动效果越明显</li>
<li>initialSpringVelocity 则表示初始的速度，数值越大一开始移动越快，初始速度取值较高而时间较短时，会出现反弹情况</li>
</ul>
<h4 id="初始化信息"><a href="#初始化信息" class="headerlink" title="初始化信息"></a>初始化信息</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化子控件</span></span><br><span class="line">setupUI()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置用户信息</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> iconUrl = <span class="type">UserAccount</span>.loadAccount()?.avatar_large &#123;</span><br><span class="line">iconView.sd_setImage(with: <span class="type">NSURL</span>(string: iconUrl)! <span class="keyword">as</span> <span class="type">URL</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="跟控制器切换"><a href="#跟控制器切换" class="headerlink" title="跟控制器切换"></a>跟控制器切换</h3><p>原理图：<br><img src="http://7xv233.com1.z0.glb.clouddn.com/weibo%25E7%2595%258C%25E9%259D%25A2%25E5%2588%2587%25E6%258D%25A2%25E6%25B5%2581%25E7%25A8%258B%25E5%259B%25BE.png" alt="image"></p>
<h4 id="判断新版本"><a href="#判断新版本" class="headerlink" title="判断新版本"></a>判断新版本</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isNewUpdate</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="comment">// 获取当前版本信息</span></span><br><span class="line">    <span class="keyword">let</span> currentVersion = <span class="type">Bundle</span>.main.infoDictionary![<span class="string">"CFBundleShortVersionString"</span>] <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> version = <span class="type">NumberFormatter</span>().number(from: currentVersion)?.doubleValue ?? <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取沙盒版本信息</span></span><br><span class="line">    <span class="keyword">let</span> versionKey = <span class="string">"versionKey"</span></span><br><span class="line">    <span class="keyword">let</span> sandboxVersion = <span class="type">UserDefaults</span>.standard.double(forKey: versionKey)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存当前版本</span></span><br><span class="line">    <span class="type">UserDefaults</span>.standard.<span class="keyword">set</span>(version, forKey: versionKey)</span><br><span class="line">    <span class="keyword">return</span> version &gt; sandboxVersion</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="显示的默认控制器"><a href="#显示的默认控制器" class="headerlink" title="显示的默认控制器"></a>显示的默认控制器</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">defaultController</span><span class="params">()</span></span> -&gt; <span class="type">UIViewController</span>&#123;</span><br><span class="line">    <span class="comment">// 判断用户是否登录</span></span><br><span class="line">    <span class="keyword">if</span> <span class="type">UserAccount</span>.userLogin() &#123;</span><br><span class="line">    <span class="keyword">return</span> isNewUpdate() ? <span class="type">NewFeatureViewController</span>() : <span class="type">WelcomViewController</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MainViewController</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="定义通知"><a href="#定义通知" class="headerlink" title="定义通知"></a>定义通知</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 切换控制器通知</span></span><br><span class="line"><span class="keyword">let</span> kSwitchRootViewControllerKey = <span class="string">"kSwitchRootViewControllerKey"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册通知</span></span><br><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(<span class="keyword">self</span>, selector: #selector(switchRootViewController(notify:)), name: <span class="type">NSNotification</span>.<span class="type">Name</span>(rawValue: kSwitchRootViewControllerKey), object: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 监听方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">switchRootViewController</span><span class="params">(notify:Notification)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> notify.object <span class="keyword">as</span>! <span class="type">Bool</span> &#123;</span><br><span class="line">        window?.rootViewController = <span class="type">MainViewController</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        window?.rootViewController = <span class="type">WelcomViewController</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="注销通知"><a href="#注销通知" class="headerlink" title="注销通知"></a>注销通知</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">deinit</span> &#123;</span><br><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.removeObserver(<span class="keyword">self</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="发送通知"><a href="#发送通知" class="headerlink" title="发送通知"></a>发送通知</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.post(name: <span class="type">Notification</span>.<span class="type">Name</span>(rawValue: kSwitchRootViewControllerKey), object: <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="更新时间：2018-05-09-10-13-03"><a href="#更新时间：2018-05-09-10-13-03" class="headerlink" title="更新时间：2018-05-09 10:13:03"></a>更新时间：2018-05-09 10:13:03</h2><h3 id="获取微博数据"><a href="#获取微博数据" class="headerlink" title="获取微博数据"></a>获取微博数据</h3><h4 id="创建Status类"><a href="#创建Status类" class="headerlink" title="创建Status类"></a>创建Status类</h4><p>基本属性<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 微博创建时间</span></span><br><span class="line"><span class="keyword">var</span> created_at:<span class="type">String</span>?</span><br><span class="line"><span class="comment">/// 微博ID</span></span><br><span class="line"><span class="keyword">var</span> id:<span class="type">Int</span>?</span><br><span class="line"><span class="comment">/// 微博信息内容</span></span><br><span class="line"><span class="keyword">var</span> text:<span class="type">String</span>?</span><br><span class="line"><span class="comment">/// 微博来源</span></span><br><span class="line"><span class="keyword">var</span> source:<span class="type">String</span>?</span><br><span class="line"><span class="comment">/// 配图数组</span></span><br><span class="line"><span class="keyword">var</span> pic_urls: [[<span class="type">String</span>:<span class="type">AnyObject</span>]]?</span><br></pre></td></tr></table></figure></p>
<p>加载微博数据</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">loadStatuses</span>(<span class="title">finishBlock</span>:@<span class="title">escaping</span> (<span class="title">_</span> <span class="title">models</span>:[<span class="title">Status</span>]?, <span class="title">_</span> <span class="title">error</span>:<span class="title">NSError</span>?) -&gt;())</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="string">"2/statuses/home_timeline.json"</span></span><br><span class="line">    <span class="keyword">let</span> params = [<span class="string">"access_token"</span>:<span class="type">UserAccount</span>.loadAccount()!.access_token]</span><br><span class="line"></span><br><span class="line">    <span class="type">SVProgressHUD</span>.setStatus(<span class="string">"loading..."</span>)</span><br><span class="line">    <span class="type">SVProgressHUD</span>.setDefaultMaskType(<span class="type">SVProgressHUDMaskType</span>.black)</span><br><span class="line"></span><br><span class="line">    <span class="type">NetworkTools</span>.shareNetworkTools().<span class="keyword">get</span>(path, parameters: params, progress: <span class="literal">nil</span>, success: &#123; (<span class="number">_</span>, json) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> dict = json <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">AnyObject</span>]&#123;</span><br><span class="line">            <span class="comment">// 取出字典数组，转为model数组</span></span><br><span class="line">            <span class="keyword">let</span> dictList = dict[<span class="string">"statuses"</span>] <span class="keyword">as</span>! [[<span class="type">String</span>: <span class="type">AnyObject</span>]]</span><br><span class="line">            <span class="keyword">let</span> models = dictToModel(list: dictList)</span><br><span class="line">            finishBlock(models, <span class="literal">nil</span>)</span><br><span class="line">            <span class="type">SVProgressHUD</span>.dismiss()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">SVProgressHUD</span>.dismiss()</span><br><span class="line">    &#125;) &#123; (<span class="number">_</span>, error) <span class="keyword">in</span></span><br><span class="line">        finishBlock(<span class="literal">nil</span>, error <span class="keyword">as</span> <span class="type">NSError</span>)</span><br><span class="line">        <span class="type">SVProgressHUD</span>.dismiss()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="HomeTableViewController填充数据"><a href="#HomeTableViewController填充数据" class="headerlink" title="HomeTableViewController填充数据"></a>HomeTableViewController填充数据</h4><p>声明数组存储微博数据<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存微博数组</span></span><br><span class="line"><span class="keyword">var</span> statuses: [<span class="type">Status</span>]? &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        <span class="comment">// 设置数据完毕，刷新表格</span></span><br><span class="line">        tableView.reloadData()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注册cell</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册cell</span></span><br><span class="line">tableView.register(<span class="type">UITableViewCell</span>.<span class="keyword">self</span>, forCellReuseIdentifier: kHomeCellReuseIdentifier)</span><br></pre></td></tr></table></figure>
<p>加载数据</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 加载数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadData</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">Status</span>.loadStatuses &#123; (models, error) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.statuses = models</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>扩展HomeTableViewController现实数据源</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">HomeTableViewController</span> </span>&#123;</span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">numberOfSections</span><span class="params">(<span class="keyword">in</span> tableView: UITableView)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="comment">// #warning Incomplete implementation, return the number of sections</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, numberOfRowsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="comment">// #warning Incomplete implementation, return the number of rows</span></span><br><span class="line">    <span class="keyword">return</span> statuses?.<span class="built_in">count</span> ?? <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UITableViewCell</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: kHomeCellReuseIdentifier, <span class="keyword">for</span>: indexPath)</span><br><span class="line">        <span class="keyword">if</span> statuses!.<span class="built_in">count</span> &gt; indexPath.row &#123;</span><br><span class="line">            <span class="keyword">let</span> status = statuses![indexPath.row]</span><br><span class="line">            cell.textLabel?.text = status.text</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cell</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://7xv233.com1.z0.glb.clouddn.com/weibo%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE1.gif" alt="image"></p>
<h3 id="获取用户数据"><a href="#获取用户数据" class="headerlink" title="获取用户数据"></a>获取用户数据</h3><h4 id="创建User"><a href="#创建User" class="headerlink" title="创建User"></a>创建User</h4><p>声明user的属性</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 用户ID</span></span><br><span class="line"><span class="keyword">var</span> id: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line"><span class="comment">/// 名称</span></span><br><span class="line"><span class="keyword">var</span> name:<span class="type">String</span>?</span><br><span class="line"><span class="comment">/// 用户头像地址（中图）</span></span><br><span class="line"><span class="keyword">var</span> profile_image_url:<span class="type">String</span>?</span><br><span class="line"><span class="comment">/// 认证，ture是</span></span><br><span class="line"><span class="keyword">var</span> verified: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line"><span class="comment">/// 用户的认证类型， -1没有认证， 0认证用户， 2.3.5企业认证， 220达人</span></span><br><span class="line"><span class="keyword">var</span> verified_type: <span class="type">Int</span> = -<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="Status监听user的数据"><a href="#Status监听user的数据" class="headerlink" title="Status监听user的数据"></a>Status监听user的数据</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setValue</span><span class="params">(<span class="number">_</span> value: Any?, forKey key: String)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 判断当前是否给字典的user赋值</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">"user"</span> == key &#123;</span><br><span class="line">        user = <span class="type">User</span>(dict: value <span class="keyword">as</span>! [<span class="type">String</span> : <span class="type">AnyObject</span>])</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 调用父类的方法，按照系统默认处理</span></span><br><span class="line">    <span class="keyword">super</span>.setValue(value, forKey: key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="StatusTableViewCell"><a href="#StatusTableViewCell" class="headerlink" title="StatusTableViewCell"></a>StatusTableViewCell</h3><h4 id="添加子控件-1"><a href="#添加子控件-1" class="headerlink" title="添加子控件"></a>添加子控件</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">contentView.addSubview(iconView)</span><br><span class="line">contentView.addSubview(verifiedView)</span><br><span class="line">contentView.addSubview(nameLabel)</span><br><span class="line">contentView.addSubview(vipView)</span><br><span class="line">contentView.addSubview(timeLabel)</span><br><span class="line">contentView.addSubview(sourceLabel)</span><br><span class="line">contentView.addSubview(contentLabel)</span><br><span class="line">contentView.addSubview(footerView)</span><br></pre></td></tr></table></figure>
<h4 id="监听微博属性"><a href="#监听微博属性" class="headerlink" title="监听微博属性"></a>监听微博属性</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> status:<span class="type">Status</span>? &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        nameLabel.text = status?.user?.name</span><br><span class="line">        <span class="comment">//            timeLabel.text = status?.created_at</span></span><br><span class="line">        <span class="comment">//            sourceLabel.text = status?.source</span></span><br><span class="line">        timeLabel.text = <span class="string">"刚刚"</span></span><br><span class="line">        sourceLabel.text = <span class="string">"来自：daisuke"</span></span><br><span class="line">        contentLabel.text = status?.text</span><br><span class="line">        iconView.sd_setImage(with: <span class="type">URL</span>(string: (status?.user?.profile_image_url)!))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="替换UITableViewCell"><a href="#替换UITableViewCell" class="headerlink" title="替换UITableViewCell"></a>替换UITableViewCell</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span> -&gt; <span class="type">UITableViewCell</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: kHomeCellReuseIdentifier, <span class="keyword">for</span>: indexPath) <span class="keyword">as</span>! <span class="type">StatusTableViewCell</span></span><br><span class="line">    <span class="keyword">if</span> statuses!.<span class="built_in">count</span> &gt; indexPath.row &#123;</span><br><span class="line">        <span class="keyword">let</span> status = statuses![indexPath.row]</span><br><span class="line">        <span class="comment">//            cell.textLabel?.text = status.text</span></span><br><span class="line">        cell.status = status</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cell</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://7xv233.com1.z0.glb.clouddn.com/weibo%E9%A6%96%E9%A1%B5%E6%95%B0%E6%8D%AE2.gif" alt="image"></p>
<h3 id="封装UILabel和UIButton"><a href="#封装UILabel和UIButton" class="headerlink" title="封装UILabel和UIButton"></a>封装UILabel和UIButton</h3><h4 id="扩展UILabel-UILabel-Category-swift"><a href="#扩展UILabel-UILabel-Category-swift" class="headerlink" title="扩展UILabel, UILabel+Category.swift"></a>扩展UILabel, UILabel+Category.swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UILabel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 快速创建一个label</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">createLabel</span>(<span class="title">color</span>:<span class="title">UIColor</span>, <span class="title">fontSize</span>:<span class="title">CGFloat</span>) -&gt; <span class="title">UILabel</span> </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> label = <span class="type">UILabel</span>()</span><br><span class="line">        label.textColor = color</span><br><span class="line">        label.font = <span class="type">UIFont</span>.systemFont(ofSize: fontSize)</span><br><span class="line">        <span class="keyword">return</span> label</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="扩展UIButton-UIButton-Category-swift"><a href="#扩展UIButton-UIButton-Category-swift" class="headerlink" title="扩展UIButton, UIButton+Category.swift"></a>扩展UIButton, UIButton+Category.swift</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIButton</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// 快速创建一个Button</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">createButton</span>(<span class="title">imageName</span>: <span class="title">String</span>, <span class="title">title</span>: <span class="title">String</span>) -&gt; <span class="title">UIButton</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> btn = <span class="type">UIButton</span>()</span><br><span class="line">        btn.setTitle(title, <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">        btn.setImage(<span class="type">UIImage</span>(named: imageName), <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">        btn.titleLabel?.font = <span class="type">UIFont</span>.systemFont(ofSize: <span class="number">10</span>)</span><br><span class="line">        btn.setBackgroundImage(<span class="type">UIImage</span>(named: <span class="string">"timeline_card_bottom_background"</span>), <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">        btn.setTitleColor(<span class="type">UIColor</span>.darkGray, <span class="keyword">for</span>: <span class="type">UIControlState</span>.normal)</span><br><span class="line">        btn.titleEdgeInsets = <span class="type">UIEdgeInsets</span>(top: <span class="number">0</span>, <span class="keyword">left</span>: <span class="number">10</span>, bottom: <span class="number">0</span>, <span class="keyword">right</span>: <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> btn</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="StatusTableViewCell-swift重构"><a href="#StatusTableViewCell-swift重构" class="headerlink" title="StatusTableViewCell.swift重构"></a>StatusTableViewCell.swift重构</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 昵称</span></span><br><span class="line"><span class="comment">//    private lazy var nameLabel: UILabel = &#123;</span></span><br><span class="line"><span class="comment">//        let name = UILabel()</span></span><br><span class="line"><span class="comment">//        name.textColor = UIColor.darkGray</span></span><br><span class="line"><span class="comment">//        name.font = UIFont.systemFont(ofSize: 14)</span></span><br><span class="line"><span class="comment">//        return name</span></span><br><span class="line"><span class="comment">//    &#125;()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> nameLabel: <span class="type">UILabel</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> name = <span class="type">UILabel</span>.createLabel(color: <span class="type">UIColor</span>.darkGray, fontSize: <span class="number">14</span>)</span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    private lazy var commonBtn: UIButton = &#123;</span></span><br><span class="line"><span class="comment">//        let btn = UIButton()</span></span><br><span class="line"><span class="comment">//        btn.setImage(UIImage(named: "timeline_icon_comment"), for: UIControlState.normal)</span></span><br><span class="line"><span class="comment">//        btn.setTitle("评论", for: UIControlState.normal)</span></span><br><span class="line"><span class="comment">//        btn.titleLabel?.font = UIFont.systemFont(ofSize: 10)</span></span><br><span class="line"><span class="comment">//        btn.setTitleColor(UIColor.darkGray, for: UIControlState.normal)</span></span><br><span class="line"><span class="comment">//        btn.titleEdgeInsets = UIEdgeInsetsMake(0, 10, 0, 0)</span></span><br><span class="line"><span class="comment">//        btn.setBackgroundImage(UIImage(named: "timeline_card_bottom_background"), for: UIControlState.normal)</span></span><br><span class="line"><span class="comment">//        return btn</span></span><br><span class="line"><span class="comment">//    &#125;()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> commonBtn: <span class="type">UIButton</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> btn = <span class="type">UIButton</span>.createButton(imageName: <span class="string">"timeline_icon_comment"</span>, title: <span class="string">"评论"</span>)</span><br><span class="line">    <span class="keyword">return</span> btn</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="更新时间：2018-05-10-10-11-16"><a href="#更新时间：2018-05-10-10-11-16" class="headerlink" title="更新时间：2018-05-10 10:11:16"></a>更新时间：2018-05-10 10:11:16</h2><h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><h4 id="认证图标"><a href="#认证图标" class="headerlink" title="认证图标"></a>认证图标</h4><p>User.swift<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 用户的认证类型， -1没有认证， 0认证用户， 2.3.5企业认证， 220达人</span></span><br><span class="line"><span class="keyword">var</span> verified_type: <span class="type">Int</span> = -<span class="number">1</span> &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> verified_type &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            verifiedImage = <span class="type">UIImage</span>(named: <span class="string">"avatar_vip"</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>:</span><br><span class="line">            verifiedImage = <span class="type">UIImage</span>(named: <span class="string">"avatar_enterprise_vip"</span>)</span><br><span class="line">        <span class="keyword">case</span> <span class="number">220</span>:</span><br><span class="line">            verifiedImage = <span class="type">UIImage</span>(named: <span class="string">"avatar_grassroot"</span>)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            verifiedImage = <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 保存当前用户的认证图片</span></span><br><span class="line"><span class="keyword">var</span> verifiedImage:<span class="type">UIImage</span>?</span><br></pre></td></tr></table></figure></p>
<p>StatusTableViewCell.swift</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> status:<span class="type">Status</span>? &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        nameLabel.text = status?.user?.name</span><br><span class="line">        <span class="comment">//            timeLabel.text = status?.created_at</span></span><br><span class="line">        <span class="comment">//            sourceLabel.text = status?.source</span></span><br><span class="line">        timeLabel.text = <span class="string">"刚刚"</span></span><br><span class="line">        sourceLabel.text = <span class="string">"来自：daisuke"</span></span><br><span class="line">        contentLabel.text = status?.text</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url = status?.user?.profile_image_url &#123;</span><br><span class="line">            iconView.sd_setImage(with: <span class="type">URL</span>(string: url))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置会员图标</span></span><br><span class="line">        verifiedView.image = status?.user?.verifiedImage</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="会员图标"><a href="#会员图标" class="headerlink" title="会员图标"></a>会员图标</h4><p>User.swift</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 会员等级</span></span><br><span class="line"><span class="keyword">var</span> mbrank: <span class="type">Int</span> = <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> mbrank &gt; <span class="number">0</span> &amp;&amp; mbrank &lt; <span class="number">7</span> &#123;</span><br><span class="line">            mbrankImage = <span class="type">UIImage</span>(named: <span class="string">"common_icon_membership_level<span class="subst">\(mbrank)</span>"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 会员图标</span></span><br><span class="line"><span class="keyword">var</span> mbrankImage:<span class="type">UIImage</span>?</span><br></pre></td></tr></table></figure>
<p>StatusTableViewCell.swift</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> status:<span class="type">Status</span>? &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        nameLabel.text = status?.user?.name</span><br><span class="line">        <span class="comment">//            timeLabel.text = status?.created_at</span></span><br><span class="line">        <span class="comment">//            sourceLabel.text = status?.source</span></span><br><span class="line">        timeLabel.text = <span class="string">"刚刚"</span></span><br><span class="line">        sourceLabel.text = <span class="string">"来自：daisuke"</span></span><br><span class="line">        contentLabel.text = status?.text</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> url = status?.user?.profile_image_url &#123;</span><br><span class="line">            iconView.sd_setImage(with: <span class="type">URL</span>(string: url))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置会员图标</span></span><br><span class="line">        verifiedView.image = status?.user?.verifiedImage</span><br><span class="line">        vipView.image = status?.user?.mbrankImage</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="来源处理"><a href="#来源处理" class="headerlink" title="来源处理"></a>来源处理</h4><p>Status.swift<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 微博来源</span></span><br><span class="line"><span class="keyword">var</span> source:<span class="type">String</span>? &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        <span class="comment">// &lt;a href=\"http://app.weibo.com/t/feed/4fuyNj\" rel=\"nofollow\"&gt;即刻笔记&lt;/a&gt;</span></span><br><span class="line">        <span class="comment">// 截取字符串</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> str = source &#123;</span><br><span class="line">            <span class="comment">// 获取开始截取的位置</span></span><br><span class="line">            <span class="keyword">let</span> startLocation = (str <span class="keyword">as</span> <span class="type">NSString</span>).range(of: <span class="string">"&gt;"</span>).location+<span class="number">1</span></span><br><span class="line">            <span class="comment">// 获取截取的长度</span></span><br><span class="line">            <span class="keyword">let</span> length = (str <span class="keyword">as</span> <span class="type">NSString</span>).range(of: <span class="string">"&lt;"</span>, options: <span class="type">NSString</span>.<span class="type">CompareOptions</span>.backwards).location - startLocation</span><br><span class="line">            source = <span class="string">"来自:"</span>+(str <span class="keyword">as</span> <span class="type">NSString</span>).substring(with: <span class="type">NSRange</span>(location: startLocation, length: length))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="创建时间处理"><a href="#创建时间处理" class="headerlink" title="创建时间处理"></a>创建时间处理</h4><p>扩展NSDate，创建Date+Category.swift</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSDate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 字符串转date</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">dateWithString</span>(<span class="title">time</span>:<span class="title">String</span>) -&gt; <span class="title">NSDate</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建fomatter</span></span><br><span class="line">        <span class="keyword">let</span> fomatter = <span class="type">DateFormatter</span>()</span><br><span class="line">        <span class="comment">// 设置时间格式</span></span><br><span class="line">        fomatter.dateFormat = <span class="string">"EEE MMM d HH:mm:ss Z yyyy"</span></span><br><span class="line">        <span class="comment">// 设置时间的区域（真机必须设置，否则可能转换不成功）</span></span><br><span class="line">        fomatter.locale = <span class="type">Locale</span>(identifier: <span class="string">"en"</span>)</span><br><span class="line">        <span class="keyword">let</span> createDate = fomatter.date(from: time)!</span><br><span class="line">        <span class="keyword">return</span> createDate <span class="keyword">as</span> <span class="type">NSDate</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    刚刚(一分钟内)</span><br><span class="line">    X分钟前(一小时内)</span><br><span class="line">    X小时前(当天)</span><br><span class="line">    昨天 HH:mm(昨天)</span><br><span class="line">    MM-dd HH:mm(一年内)</span><br><span class="line">    yyyy-MM-dd HH:mm(更早期)</span><br><span class="line">    */</span></span><br><span class="line">    <span class="keyword">var</span> descDate:<span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> calendar = <span class="type">NSCalendar</span>.current</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否今天</span></span><br><span class="line">        <span class="keyword">if</span> calendar.isDateInToday(<span class="keyword">self</span> <span class="keyword">as</span> <span class="type">Date</span>) &#123;</span><br><span class="line">            <span class="comment">// 获取当前时间和系统时间之间的差距</span></span><br><span class="line">            <span class="keyword">let</span> since = <span class="type">Int</span>(<span class="type">NSDate</span>().timeIntervalSince(<span class="keyword">self</span> <span class="keyword">as</span> <span class="type">Date</span>))</span><br><span class="line">            <span class="keyword">if</span> since &lt; <span class="number">60</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"刚刚"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> since &lt; <span class="number">60</span> * <span class="number">60</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"<span class="subst">\(since/<span class="number">60</span>)</span>分钟前"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"<span class="subst">\(since/<span class="number">60</span>/<span class="number">60</span>)</span>小时前"</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否是昨天</span></span><br><span class="line">        <span class="keyword">var</span> fomatterStr = <span class="string">"HH:mm"</span></span><br><span class="line">        <span class="keyword">if</span> calendar.isDateInYesterday(<span class="keyword">self</span> <span class="keyword">as</span> <span class="type">Date</span>) &#123;</span><br><span class="line">            fomatterStr = <span class="string">"昨天:"</span> + fomatterStr</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 处理一年以内</span></span><br><span class="line">            fomatterStr = <span class="string">"MM-dd"</span> + fomatterStr</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理更早时间</span></span><br><span class="line">            <span class="keyword">let</span> comps = calendar.dateComponents([<span class="type">Calendar</span>.<span class="type">Component</span>.year], from: (<span class="keyword">self</span> <span class="keyword">as</span> <span class="type">Date</span>), to: <span class="type">Date</span>())</span><br><span class="line">            <span class="keyword">if</span> comps.year! &gt;= <span class="number">1</span> &#123;</span><br><span class="line">                fomatterStr = <span class="string">"yyyy-"</span> + fomatterStr</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建fomatter</span></span><br><span class="line">        <span class="keyword">let</span> fomatter = <span class="type">DateFormatter</span>()</span><br><span class="line">        fomatter.dateFormat = fomatterStr</span><br><span class="line">        fomatter.locale = <span class="type">Locale</span>(identifier: <span class="string">"en"</span>)</span><br><span class="line">        <span class="keyword">return</span> fomatter.string(from: <span class="keyword">self</span> <span class="keyword">as</span> <span class="type">Date</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Status.swift</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 微博创建时间</span></span><br><span class="line"><span class="keyword">var</span> created_at:<span class="type">String</span>? &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> date = <span class="type">NSDate</span>.dateWithString(time: created_at!)</span><br><span class="line">        created_at = date.descDate</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="缓存配图"><a href="#缓存配图" class="headerlink" title="缓存配图"></a>缓存配图</h4><p>Status.swift</p>
<p>添加storedPicURLs数组&amp;重写pic_urls的set方法<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 配图数组</span></span><br><span class="line"><span class="keyword">var</span> pic_urls: [[<span class="type">String</span>:<span class="type">AnyObject</span>]]? &#123;</span><br><span class="line">    <span class="keyword">didSet</span> &#123;</span><br><span class="line">        <span class="comment">// 初始化数组</span></span><br><span class="line">        storedPicURLs = [<span class="type">NSURL</span>]()</span><br><span class="line">        <span class="keyword">for</span> dict <span class="keyword">in</span> pic_urls! &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> urlStr = dict[<span class="string">"thumbnail_pic"</span>]&#123;</span><br><span class="line">                <span class="comment">// 将字符串转为URL保存到数组中</span></span><br><span class="line">                storedPicURLs?.append(<span class="type">NSURL</span>(string: urlStr <span class="keyword">as</span>! <span class="type">String</span>)!)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 保存当前微博所有配图的URL</span></span><br><span class="line"><span class="keyword">var</span> storedPicURLs:[<span class="type">NSURL</span>]?</span><br></pre></td></tr></table></figure></p>
<p>添加类方法缓存微博图片</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 缓存微博图片</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">cacheStatusImages</span>(<span class="title">list</span>:[<span class="title">Status</span>], <span class="title">finishBlock</span>:@<span class="title">escaping</span> (<span class="title">_</span> <span class="title">models</span>:[<span class="title">Status</span>]?, <span class="title">_</span> <span class="title">error</span>:<span class="title">NSError</span>?) -&gt;()) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个数组</span></span><br><span class="line">    <span class="keyword">let</span> group = <span class="type">DispatchGroup</span>()</span><br><span class="line">    <span class="keyword">for</span> status <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> status.storedPicURLs! &#123;</span><br><span class="line">            <span class="comment">// 将当前的下载操作添加到组</span></span><br><span class="line">            group.enter()</span><br><span class="line"></span><br><span class="line">            <span class="type">SDWebImageManager</span>.shared().downloadImage(with: url <span class="keyword">as</span> <span class="type">URL</span>, options: <span class="type">SDWebImageOptions</span>(rawValue: <span class="number">0</span>), progress: <span class="literal">nil</span>) &#123; (<span class="number">_</span>, <span class="number">_</span>, <span class="number">_</span>, <span class="number">_</span>, <span class="number">_</span>) <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// 离开当前组</span></span><br><span class="line">                group.leave()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当所有图片都下载完毕再通过闭包通用调用者</span></span><br><span class="line">    group.notify(queue: <span class="type">DispatchQueue</span>.main) &#123;</span><br><span class="line">        <span class="comment">// 能够来到这个地方，一定是所有图片都下载完毕</span></span><br><span class="line">        finishBlock(list, <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用缓存微博图片方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 加载微博数据</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">loadStatuses</span>(<span class="title">finishBlock</span>:@<span class="title">escaping</span> (<span class="title">_</span> <span class="title">models</span>:[<span class="title">Status</span>]?, <span class="title">_</span> <span class="title">error</span>:<span class="title">NSError</span>?) -&gt;())</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="string">"2/statuses/home_timeline.json"</span></span><br><span class="line">    <span class="keyword">let</span> params = [<span class="string">"access_token"</span>:<span class="type">UserAccount</span>.loadAccount()!.access_token]</span><br><span class="line"></span><br><span class="line">    <span class="type">SVProgressHUD</span>.setStatus(<span class="string">"loading..."</span>)</span><br><span class="line">    <span class="type">SVProgressHUD</span>.setDefaultMaskType(<span class="type">SVProgressHUDMaskType</span>.black)</span><br><span class="line"></span><br><span class="line">    <span class="type">NetworkTools</span>.shareNetworkTools().<span class="keyword">get</span>(path, parameters: params, progress: <span class="literal">nil</span>, success: &#123; (<span class="number">_</span>, json) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> dict = json <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">AnyObject</span>]&#123;</span><br><span class="line">            <span class="comment">// 取出字典数组，转为model数组</span></span><br><span class="line">            <span class="keyword">let</span> dictList = dict[<span class="string">"statuses"</span>] <span class="keyword">as</span>! [[<span class="type">String</span>: <span class="type">AnyObject</span>]]</span><br><span class="line">            <span class="keyword">let</span> models = dictToModel(list: dictList)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//                finishBlock(models, nil)</span></span><br><span class="line">            <span class="comment">// 替换成缓存微博图片方法</span></span><br><span class="line">            cacheStatusImages(list: models, finishBlock: finishBlock)</span><br><span class="line"></span><br><span class="line">            <span class="type">SVProgressHUD</span>.dismiss()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">SVProgressHUD</span>.dismiss()</span><br><span class="line">    &#125;) &#123; (<span class="number">_</span>, error) <span class="keyword">in</span></span><br><span class="line">        finishBlock(<span class="literal">nil</span>, error <span class="keyword">as</span> <span class="type">NSError</span>)</span><br><span class="line">        <span class="type">SVProgressHUD</span>.dismiss()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Swift/" rel="tag">#Swift</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/04/26/Swift-访问控制/" rel="next" title="Swift-访问控制">
                <i class="fa fa-chevron-left"></i> Swift-访问控制
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2018/05/09/Swift-微博/"
           data-title="Swift-微博" data-url="http://yoursite.com/2018/05/09/Swift-微博/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="DaiSuke" />
          <p class="site-author-name" itemprop="name">DaiSuke</p>
          <p class="site-description motion-element" itemprop="description">just's like IT</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">33</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/DaisukeZJY" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/DaisukeZJY" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/527447678/home" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#工程地址"><span class="nav-number">1.</span> <span class="nav-text">工程地址</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建工程"><span class="nav-number">2.</span> <span class="nav-text">创建工程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除StoryBoard"><span class="nav-number">3.</span> <span class="nav-text">删除StoryBoard</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#框架搭建"><span class="nav-number">4.</span> <span class="nav-text">框架搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加中间按钮"><span class="nav-number">5.</span> <span class="nav-text">添加中间按钮</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新时间：2018-04-27-14-24-34"><span class="nav-number"></span> <span class="nav-text">更新时间：2018-04-27 14:24:34</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#重构MainViewController"><span class="nav-number">1.</span> <span class="nav-text">重构MainViewController</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加VisitorView视图"><span class="nav-number">2.</span> <span class="nav-text">添加VisitorView视图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#定义协议"><span class="nav-number">2.1.</span> <span class="nav-text">定义协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用弱引用"><span class="nav-number">2.2.</span> <span class="nav-text">使用弱引用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重写初始化方法注意点"><span class="nav-number">2.3.</span> <span class="nav-text">重写初始化方法注意点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加BaseViewController控制器"><span class="nav-number">3.</span> <span class="nav-text">添加BaseViewController控制器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主控制器继承基类"><span class="nav-number">4.</span> <span class="nav-text">主控制器继承基类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导航条按钮"><span class="nav-number">5.</span> <span class="nav-text">导航条按钮</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新时间：2018-04-27-16-53-34"><span class="nav-number"></span> <span class="nav-text">更新时间：2018-04-27 16:53:34</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CocoPods"><span class="nav-number">1.</span> <span class="nav-text">CocoPods</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第三方框架"><span class="nav-number">1.1.</span> <span class="nav-text">第三方框架</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#项目中使用到以下第三方框架"><span class="nav-number">1.1.1.</span> <span class="nav-text">项目中使用到以下第三方框架</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pod-安装"><span class="nav-number">1.2.</span> <span class="nav-text">Pod 安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在终端提交添加的框架"><span class="nav-number">1.3.</span> <span class="nav-text">在终端提交添加的框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装第三方框架"><span class="nav-number">1.4.</span> <span class="nav-text">安装第三方框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#打开xcworkspace工程"><span class="nav-number">1.5.</span> <span class="nav-text">打开xcworkspace工程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加桥接文件DWeibo-Bridge"><span class="nav-number">1.6.</span> <span class="nav-text">添加桥接文件DWeibo-Bridge</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新时间：2018-04-28-15-28-34"><span class="nav-number"></span> <span class="nav-text">更新时间：2018-04-28 15:28:34</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#微博API"><span class="nav-number">1.</span> <span class="nav-text">微博API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#授权"><span class="nav-number">2.</span> <span class="nav-text">授权</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建OAuthViewController"><span class="nav-number">2.1.</span> <span class="nav-text">创建OAuthViewController</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UserAccount存储用户信息"><span class="nav-number">2.2.</span> <span class="nav-text">UserAccount存储用户信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#归档用户信息"><span class="nav-number">2.3.</span> <span class="nav-text">归档用户信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取用户信息"><span class="nav-number">2.4.</span> <span class="nav-text">获取用户信息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新时间：2018-05-08-15-07-39"><span class="nav-number"></span> <span class="nav-text">更新时间：2018-05-08 15:07:39</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#新特性"><span class="nav-number">1.</span> <span class="nav-text">新特性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建NewFeatureViewController"><span class="nav-number">1.1.</span> <span class="nav-text">创建NewFeatureViewController</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建NewFeatureCell"><span class="nav-number">1.2.</span> <span class="nav-text">创建NewFeatureCell</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建NewFeatureLayout"><span class="nav-number">1.3.</span> <span class="nav-text">创建NewFeatureLayout</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完善-amp-添加按钮"><span class="nav-number">2.</span> <span class="nav-text">完善&添加按钮</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新时间：2018-05-08-16-00-03"><span class="nav-number"></span> <span class="nav-text">更新时间：2018-05-08 16:00:03</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加欢迎界面"><span class="nav-number">1.</span> <span class="nav-text">添加欢迎界面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#添加子控件"><span class="nav-number">1.1.</span> <span class="nav-text">添加子控件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加显示动画"><span class="nav-number">1.2.</span> <span class="nav-text">添加显示动画</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#初始化信息"><span class="nav-number">1.3.</span> <span class="nav-text">初始化信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#跟控制器切换"><span class="nav-number">2.</span> <span class="nav-text">跟控制器切换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#判断新版本"><span class="nav-number">2.1.</span> <span class="nav-text">判断新版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#显示的默认控制器"><span class="nav-number">2.2.</span> <span class="nav-text">显示的默认控制器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义通知"><span class="nav-number">2.3.</span> <span class="nav-text">定义通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注销通知"><span class="nav-number">2.4.</span> <span class="nav-text">注销通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#发送通知"><span class="nav-number">2.5.</span> <span class="nav-text">发送通知</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新时间：2018-05-09-10-13-03"><span class="nav-number"></span> <span class="nav-text">更新时间：2018-05-09 10:13:03</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取微博数据"><span class="nav-number">1.</span> <span class="nav-text">获取微博数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建Status类"><span class="nav-number">1.1.</span> <span class="nav-text">创建Status类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HomeTableViewController填充数据"><span class="nav-number">1.2.</span> <span class="nav-text">HomeTableViewController填充数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取用户数据"><span class="nav-number">2.</span> <span class="nav-text">获取用户数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建User"><span class="nav-number">2.1.</span> <span class="nav-text">创建User</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Status监听user的数据"><span class="nav-number">2.2.</span> <span class="nav-text">Status监听user的数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StatusTableViewCell"><span class="nav-number">3.</span> <span class="nav-text">StatusTableViewCell</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#添加子控件-1"><span class="nav-number">3.1.</span> <span class="nav-text">添加子控件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#监听微博属性"><span class="nav-number">3.2.</span> <span class="nav-text">监听微博属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#替换UITableViewCell"><span class="nav-number">3.3.</span> <span class="nav-text">替换UITableViewCell</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#封装UILabel和UIButton"><span class="nav-number">4.</span> <span class="nav-text">封装UILabel和UIButton</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#扩展UILabel-UILabel-Category-swift"><span class="nav-number">4.1.</span> <span class="nav-text">扩展UILabel, UILabel+Category.swift</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#扩展UIButton-UIButton-Category-swift"><span class="nav-number">4.2.</span> <span class="nav-text">扩展UIButton, UIButton+Category.swift</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#StatusTableViewCell-swift重构"><span class="nav-number">4.3.</span> <span class="nav-text">StatusTableViewCell.swift重构</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更新时间：2018-05-10-10-11-16"><span class="nav-number"></span> <span class="nav-text">更新时间：2018-05-10 10:11:16</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据处理"><span class="nav-number">1.</span> <span class="nav-text">数据处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#认证图标"><span class="nav-number">1.1.</span> <span class="nav-text">认证图标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#会员图标"><span class="nav-number">1.2.</span> <span class="nav-text">会员图标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#来源处理"><span class="nav-number">1.3.</span> <span class="nav-text">来源处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建时间处理"><span class="nav-number">1.4.</span> <span class="nav-text">创建时间处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#缓存配图"><span class="nav-number">1.5.</span> <span class="nav-text">缓存配图</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DaiSuke</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"daisukecn"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("EHtYvSIfNxQXWTd66LKTOamk-gzGzoHsz", "QmOk07bceNRvEUFI2Wxs2R0n");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
